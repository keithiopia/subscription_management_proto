Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},s=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,s.prototype=new i,s}),"undefined"==typeof window.GOVUK&&(window.GOVUK={}),"undefined"==typeof window.GOVUK.support&&(window.GOVUK.support={}),window.GOVUK.support.history=function(){return window.history&&window.history.pushState&&window.history.replaceState},function(){"use strict";function t(t){0!==t.$el.length&&GOVUK.support.history()&&(e(window).width()<640||(this.$el=t.$el,this.$root=this.$el.find("#root"),this.$section=this.$el.find("#section"),this.$subsection=this.$el.find("#subsection"),this.$breadcrumbs=e(".govuk-breadcrumbs"),this.animateSpeed=330,0===this.$section.length&&(this.$section=e('<div id="section" class="section-pane pane with-sort" />'),this.$el.prepend(this.$section),this.$el.addClass("section")),0===this.$subsection.length?(this.$subsection=e('<div id="subsection" class="subsection-pane pane" />').hide(),this.$el.prepend(this.$subsection)):this.$subsection.show(),this.displayState=this.$el.data("state"),"undefined"==typeof this.displayState&&(this.displayState="root"),this._cache={},this.lastState=this.parsePathname(window.location.pathname),this.$el.on("click","a",this.navigate.bind(this)),e(window).on("popstate",this.popState.bind(this))))}window.GOVUK=window.GOVUK||{};var e=window.jQuery;t.prototype={popState:function(t){var e,n=t.originalEvent.state;n||(n=this.parsePathname(window.location.pathname)),this.lastState.slug!==n.slug&&(e=""==n.slug?this.showRoot():n.subsection?this.restoreSubsection(n):this.loadSectionFromState(n,!0),e.then(function(){this.trackPageview(n)}.bind(this)))},restoreSubsection:function(t){if(this.lastState.section!=t.section){var e=window.location.pathname.split("/").slice(0,-1).join("/"),n=this.parsePathname(e);return this.loadSectionFromState(n,!0).then(function(){return this.loadSectionFromState(t,!0)}.bind(this))}return this.loadSectionFromState(t,!0)},sectionCache:function(t,e,n){return"undefined"==typeof n?this._cache[t+e]:void(this._cache[t+e]=n)},isDesktop:function(){return e(window).width()>768},showRoot:function(){this.$section.html(""),this.displayState="root",this.$root.find("h1").focus();var t=new e.Deferred;return t.resolve()},showSection:function(t){t.title=this.getTitle(t.slug),this.setTitle(t.title),this.$section.html(t.sectionData.html),this.highlightSection("root",t.path),this.removeLoading(),this.updateBreadcrumbs(t);var n;return"subsection"===this.displayState?n=this.animateSubsectionToSectionDesktop():"root"===this.displayState?n=this.animateRootToSectionDesktop():(n=new e.Deferred,n.resolve()),n.then(function(){this.$section.find("h1").focus()}.bind(this))},animateSubsectionToSectionDesktop:function(){function t(){this.displayState="section",this.$el.removeClass("subsection").addClass("section"),this.$section.attr("style",""),this.$section.find(".pane-inner").attr("style",""),this.$section.addClass("with-sort"),this.$root.attr("style",""),n.resolve()}var n=new e.Deferred;if(this.$root.css({position:"absolute",width:this.$root.width()}),this.$subsection.hide(),this.$section.css("margin-right","63%"),this.isDesktop()){this.$section.find(".pane-inner.curated").animate({paddingLeft:"30px"},this.animateSpeed),this.$section.find(".pane-inner.alphabetical").animate({paddingLeft:"96px"},this.animateSpeed);var i={width:"35%",marginLeft:"0%",marginRight:"40%"}}else var i={width:"30%",marginLeft:"0%",marginRight:"45%"};return this.$section.animate(i,this.animateSpeed,t.bind(this)),n},animateRootToSectionDesktop:function(){var t=new e.Deferred;return this.displayState="section",this.$el.removeClass("subsection").addClass("section"),t.resolve()},showSubsection:function(t){t.title=this.getTitle(t.slug),this.setTitle(t.title),this.$subsection.html(t.sectionData.html),this.highlightSection("section",t.path),this.highlightSection("root","/browse/"+t.section),this.removeLoading(),this.updateBreadcrumbs(t);var n;return"subsection"!==this.displayState?n=this.animateSectionToSubsectionDesktop():(n=new e.Deferred,n.resolve()),n.then(function(){this.$subsection.find("h1").focus()}.bind(this))},animateSectionToSubsectionDesktop:function(){var t=new e.Deferred;if(this.$root.css({position:"absolute",width:this.$root.width()}),this.$section.find(".sort-order").hide(),this.$section.find(".pane-inner").animate({paddingLeft:"0"},this.animateSpeed),this.isDesktop())var n={width:"25%",marginLeft:"-13%",marginRight:"63%"};else var n={width:"30%",marginLeft:"-18%",marginRight:"63%"};return this.$section.animate(n,this.animateSpeed,function(){this.$el.removeClass("section").addClass("subsection"),this.$subsection.show(),this.$section.removeClass("with-sort"),this.displayState="subsection",this.$section.find(".sort-order").attr("style",""),this.$section.attr("style",""),this.$section.find(".pane-inner").attr("style",""),this.$root.attr("style",""),t.resolve()}.bind(this)),t},getTitle:function(t){var e=this.$el.find('a[href$="/browse/'+t+'"]:first'),n=e.find("h3");return n.length>0?n.text():e.text()},setTitle:function(t){e("title").text(t)},addLoading:function(t){this.$el.attr("aria-busy","true"),t.addClass("loading")},removeLoading:function(){this.$el.attr("aria-busy","false"),this.$el.find("a.loading").removeClass("loading")},getSectionData:function(t){var n=this.sectionCache("section",t.slug),i=new e.Deferred,s="/browse/"+t.slug+".json";return"undefined"!=typeof t.sectionData?i.resolve(t.sectionData):"undefined"!=typeof n?i.resolve(n):e.ajax({url:s}).then(function(e){this.sectionCache("section",t.slug,e),i.resolve(e)}.bind(this)),i},highlightSection:function(t,e){this.$el.find("#"+t+" .active").removeClass("active"),this.$el.find('a[href$="'+e+'"]').parent().addClass("active")},parsePathname:function(t){var e={path:t,slug:t.replace(/\/browse\/?/,"")};return e.slug.indexOf("/")>-1?(e.section=e.slug.split("/")[0],e.subsection=e.slug.split("/")[1]):e.section=e.slug,e},scrollToBrowse:function(){var t=e("body"),n=this.$el.offset().top;t.scrollTop()>n&&e("body").animate({scrollTop:n},this.animateSpeed)},loadSectionFromState:function(t,n){var i=this.getSectionData(t);if(t.subsection){var s=i;i=e.when(s)}return i.then(function(e){return t.sectionData=e,this.scrollToBrowse(),this.lastState=t,t.subsection?this.showSubsection(t):this.showSection(t)}.bind(this)).then(function(){"undefined"==typeof n&&(history.pushState(t,"",t.path),this.trackPageview(t))}.bind(this))},navigate:function(t){if(t.currentTarget.pathname.match(/^\/browse\/[^\/]+(\/[^\/]+)?$/)){var n=e(t.currentTarget);t.preventDefault();var i=this.parsePathname(t.currentTarget.pathname);if(i.title=n.text(),i.path===window.location.pathname)return;this.addLoading(n),this.loadSectionFromState(i)}},updateBreadcrumbs:function(t){var n=e(t.sectionData.breadcrumbs);this.$breadcrumbs.html(n.html())},trackPageview:function(t){var e=this.$section.find("h1").text();e=e?e.toLowerCase():"browse";var n="none";"section"==this.displayState?n="First Level Browse":"subsection"==this.displayState&&(n="Second Level Browse"),GOVUK.analytics&&GOVUK.analytics.trackPageview&&GOVUK.analytics.trackPageview(t.path,null,{dimension1:e,dimension32:n})}},GOVUK.BrowseColumns=t,e(function(){GOVUK.browseColumns=new t({$el:e(".browse-panes")})})}(),function(t){"use strict";t.GOVUK=t.GOVUK||{},t.GOVUK.getCurrentLocation=function(){return t.location}}(window),function(){"use strict";window.GOVUK=window.GOVUK||{},window.GOVUK.feeds={init:function(){$(".js-feed").on("click",window.GOVUK.feeds.toggle)},toggle:function(t){t.preventDefault();var e=$(t.target).siblings(".js-feed-panel");e.toggle(),e.find("input").select()}},$(function(){GOVUK.feeds.init()})}(),window.GOVUK.Modules=window.GOVUK.Modules||{},function(t){"use strict";t.Accordion=function(){function t(t){function n(){o(!0)}function i(){o(!1)}function s(){o(r())}function o(n){t.toggleClass("section-is-open",n),d.toggleClass("js-hidden",!n),h.attr("aria-expanded",n),u&&e(t)}function a(){return t.hasClass("section-is-open")}function r(){return!a()}function c(){u=!1}function l(){return d.find("li").length}var h=t.find(".js-section-title-button"),d=t.find(".js-panel"),u=!0;this.title=t.find(".js-section-title").text(),this.href=h.attr("href"),this.element=t,this.open=n,this.close=i,this.toggle=s,this.setIsOpen=o,this.isOpen=a,this.isClosed=r,this.preventHashUpdate=c,this.numberOfContentItems=l}function e(e){var i=new t(e),s=i.isOpen()&&"#"+e.attr("id");n(s)}function n(t){if(GOVUK.support.history()){var e=t||GOVUK.getCurrentLocation().pathname;history.replaceState({},"",e)}}function i(t,e,n){function i(){var e={label:s(),dimension28:t.numberOfContentItems().toString()};n.track("pageElementInteraction",a(),e),t.isClosed()||n.track("navAccordionLinkClicked",String(o()),{label:t.href,dimension28:String(t.numberOfContentItems()),dimension29:t.title})}function s(){return o()+". "+t.title}function o(){return e.index(t.element)+1}function a(){return t.isClosed()?"accordionClosed":"accordionOpened"}this.track=i}function s(t){this.track=function(e,n,i){GOVUK.analytics&&GOVUK.analytics.trackEvent&&(i=i||{},i.dimension28=i.dimension28||t.toString(),GOVUK.analytics.trackEvent(e,n,i))}}var o={openAll:{buttonText:"Open all",eventLabel:"Open All"},closeAll:{buttonText:"Close all",eventLabel:"Close All"}};this.start=function(e){function a(){h();var t=p();document.body.scrollTop=t&&t.length?t.offset().top:0}function r(){e.prepend('<div class="app-c-accordion__controls"><button aria-expanded="false" class="app-c-accordion__button app-c-accordion__button--controls js-section-controls-button">'+o.openAll.buttonText+"</button></div>")}function c(){C.append('<span class="app-c-accordion__icon"></span>')}function l(){for(var t="",n=e.find(".js-panel"),i=0;x>i;i++)t+=n[i].id+" ";y=e.find(".js-section-controls-button"),y.attr("aria-controls",t)}function h(){d(!1)}function d(e){$.each(O,function(){var n=new t($(this));n.preventHashUpdate(),n.setIsOpen(e)})}function u(){var e=p();if(e&&e.length){var n=new t(e);n.open()}}function p(){var t=f();return t.length?e.find("#"+S(t.substr(1))):null}function f(){return GOVUK.getCurrentLocation().hash}function w(){$.each(O,function(){var t=$(this),e=t.find(".js-section-title"),n=t.find(".js-panel").first().attr("id");e.wrapInner('<button class="app-c-accordion__button app-c-accordion__button--title js-section-title-button" aria-expanded="false" aria-controls="'+n+'"></button>')})}function b(n){e.find(".js-toggle-panel").click(function(e){g(e);var s=new t($(this).closest(".js-section"));s.toggle();var o=new i(s,O,n);o.track(),v()})}function g(t){t.metaKey||t.ctrlKey||t.preventDefault()}function m(t){y=e.find(".js-section-controls-button"),y.on("click",function(){var e;return y.text()==o.openAll.buttonText?(y.text(o.closeAll.buttonText),e=!0,t.track("pageElementInteraction","accordionAllOpened",{label:o.openAll.eventLabel})):(y.text(o.openAll.buttonText),e=!1,t.track("pageElementInteraction","accordionAllClosed",{label:o.closeAll.eventLabel})),d(e),y.attr("aria-expanded",e),v(),n(null),!1})}function v(){var t=e.find(".section-is-open").length;t===x?y.text(o.closeAll.buttonText):y.text(o.openAll.buttonText)}function S(t){var e=/([\x00-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;return t.replace(e,"\\$&")}$(window).unload(a),e.addClass("app-c-accordion--active"),e.removeClass("js-hidden");var y,O=e.find(".js-section"),C=e.find(".js-toggle-panel"),x=e.find(".js-panel").length,K=new s(x);w(),r(),c(),l(),h(),u(),b(K),m(K)}}}(window.GOVUK.Modules);