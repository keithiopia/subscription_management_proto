!function(e){"use strict";window.GOVUK=window.GOVUK||{};var t=function(e,t){return t=t?'class="'+t+'"':"","<a "+t+' href="{{surveyUrl}}" id="take-survey" target="_blank" rel="noopener noreferrer">'+e+"</a>"},r=function(e){return'<section id="user-satisfaction-survey" class="visible" aria-hidden="false">  <div class="survey-wrapper">    <a class="survey-close-button" href="#user-survey-cancel" aria-labelledby="survey-title user-survey-cancel" id="user-survey-cancel" role="button">Close</a>    <h2 class="survey-title" id="survey-title">{{title}}</h2>'+e+"  </div></section>"},n=r("<p>"+t("{{surveyCta}}","survey-primary-link")+' <span class="postscript-cta">{{surveyCtaPostscript}}</span></p>'),a=r('<div id="email-survey-pre">  <a class="survey-primary-link" href="#email-survey-form" id="email-survey-open" rel="noopener noreferrer" role="button" aria-expanded="false">    {{surveyCta}}  </a></div><form id="email-survey-form" action="/contact/govuk/email-survey-signup" method="post" class="js-hidden" aria-hidden="true">  <div class="survey-inner-wrapper">    <div id="survey-form-description" class="survey-form-description">{{surveyFormDescription}}      <br> {{surveyFormCtaPostscript}}    </div>    <label class="survey-form-label" for="survey-email-address">      Email Address    </label>    <input name="email_survey_signup[survey_id]" type="hidden" value="{{surveyId}}">    <input name="email_survey_signup[survey_source]" type="hidden" value="{{surveySource}}">    <input class="survey-form-input" name="email_survey_signup[email_address]" id="survey-email-address" type="text" aria-describedby="survey-form-description">    <button class="survey-form-button" type="submit">{{surveyFormCta}}</button>'+t("{{surveyFormNoEmailInvite}}")+'  </div></form><div id="email-survey-post-success" class="js-hidden" aria-hidden="true" tabindex="-1">  {{surveySuccess}}</div><div id="email-survey-post-failure" class="js-hidden" aria-hidden="true" tabindex="-1">  {{surveyFailure}}</div>'),i=2,s=function(){var e=window.location.pathname;switch(!0){case/^\/working-tax-credit(?:\/|$)/.test(e):return"Working%20Tax%20Credit";case/^\/guidance\/money-laundering-regulations-register-with-hmrc(?:\/|$)/.test(e):return"Money%20Laundering%20Regulations";case/^\/child-tax-credit(?:\/|$)/.test(e):return"Child%20Tax%20Credit";case/^\/check-state-pension(?:\/|$)/.test(e):return"Check%20State%20Pension";case/^\/apply-marriage-allowance(?:\/|$)/.test(e):return"Marriage%20Allowance";case/^\/stamp-duty-land-tax(?:\/|$)/.test(e):return"Stamp%20Duty";case/^\/guidance\/pay-apprenticeship-levy(?:\/|$)/.test(e):return"Apprenticeship%20Levy";case/^\/update-company-car-details(?:\/|$)/.test(e):return"Company%20Car%20Details";case/^\/guidance\/paying-your-employees-expenses-and-benefits-through-your-payroll(?:\/|$)/.test(e):return"Employee%20Expenses%20and%20Benefits%20Through%20Payroll";case/^\/guidance\/pension-schemes-protect-your-lifetime-allowance(?:\/|$)/.test(e):return"Pension%20Lifetime%20Allowance";case/^\/send-employment-intermediary-report(?:\/|$)/.test(e):return"Employment%20Intermediary%20Report";case/^\/guidance\/tell-hmrc-about-your-employment-related-securities(?:\/|$)/.test(e):return"Employment%20Related%20Securities";case/^\/guidance\/pension-administrators-check-a-members-gmp(?:\/|$)/.test(e):return"Pension%20Administration%20Members%20GMP";default:return""}},o=function(){var e=window.location.pathname;switch(!0){case/^\/complain-about-school(?:\/|$)/.test(e):return"Complain%20about%20a%20school%20or%20childminder";case/^\/children-with-special-educational-needs(?:\/|$)/.test(e):return"Special%20educational%20needs%20SEN";case/^\/school-term-holiday-dates(?:\/|$)/.test(e):return"School%20term%20and%20holiday%20dates";case/^\/school-attendance-absence(?:\/|$)/.test(e):return"School%20attendance%20and%20absence";case/^\/school-uniform(?:\/|$)/.test(e):return"School%20uniform";case/^\/bullying-at-school(?:\/|$)/.test(e):return"Bullying%20at%20school";case/^\/health-safety-school-children(?:\/|$)/.test(e):return"Health%20and%20safety%20for%20school%20children";case/^\/school-discipline-exclusions(?:\/|$)/.test(e):return"School%20discipline%20and%20exclusions";case/^\/childcare-out-of-school-hours(?:\/|$)/.test(e):return"Childcare%20out%20of%20school%20hours";case/^\/after-school-holiday-club(?:\/|$)/.test(e):return"Find%20before%20and%20after%20school%20and%20holiday%20clubs";default:return""}},u={defaultSurvey:{url:"https://www.smartsurvey.co.uk/s/gov_uk?c={{currentPath}}",identifier:"user_satisfaction_survey",frequency:6,surveyType:"email"},smallSurveys:[{identifier:"publisher_guidance_survey",surveyType:"url",frequency:6,startTime:new Date("July 17, 2017").getTime(),endTime:new Date("August 16, 2017 23:59:50").getTime(),url:"https://www.smartsurvey.co.uk/s/govukpublisherguidance?c={{currentPath}}",templateArgs:{title:"Are you a government publisher?",surveyCta:"Answer a couple of questions about the publishing guidance.",surveyCtaPostscript:"This will open in a new tab."},activeWhen:{path:["^/guidance/content-design(?:/|$)","^/guidance/how-to-publish-on-gov-uk(?:/|$)","^/guidance/style-guide(?:/|$)","^/guidance/contact-the-government-digital-service(?:/|$)","^/topic/government-digital-guidance/content-publishing(?:/|$)"]}},{identifier:"hmrc_jul2017",surveyType:"url",frequency:20,startTime:new Date("July 21, 2017").getTime(),endTime:new Date("August 20, 2017 23:59:50").getTime(),url:"https://signup.take-part-in-research.service.gov.uk/home?utm_campaign="+s()+"&utm_source=Money_and_tax&utm_medium=gov.uk&t=HMRC",templateArgs:{title:"Help improve GOV.UK.",surveyCta:"Answer some questions about yourself to join the research community.",surveyCtaPostscript:"This link opens in a new tab."},activeWhen:{path:["^/working-tax-credit(?:/|$)","^/guidance/money-laundering-regulations-register-with-hmrc(?:/|$)","^/child-tax-credit(?:/|$)","^/check-state-pension(?:/|$)","^/apply-marriage-allowance(?:/|$)","^/stamp-duty-land-tax(?:/|$)","^/guidance/pay-apprenticeship-levy(?:/|$)","^/update-company-car-details(?:/|$)","^/guidance/paying-your-employees-expenses-and-benefits-through-your-payroll(?:/|$)","^/guidance/pension-schemes-protect-your-lifetime-allowance(?:/|$)","^/send-employment-intermediary-report(?:/|$)","^/guidance/tell-hmrc-about-your-employment-related-securities(?:/|$)","^/guidance/pension-administrators-check-a-members-gmp(?:/|$)"]}},{identifier:"dfe_jul2017",surveyType:"url",frequency:6,startTime:new Date("July 18, 2017").getTime(),endTime:new Date("August 18, 2017 23:59:50").getTime(),url:"https://signup.take-part-in-research.service.gov.uk/home?utm_campaign="+o()+"&utm_source=Education&utm_medium=gov.uk&t=DfE",templateArgs:{title:"Help improve GOV.UK.",surveyCta:"Answer some questions about yourself to join the research community.",surveyCtaPostscript:"This link opens in a new tab."},activeWhen:{path:["^/complain-about-school(?:/|$)","^/children-with-special-educational-needs(?:/|$)","^/school-term-holiday-dates(?:/|$)","^/school-attendance-absence(?:/|$)","^/school-uniform(?:/|$)","^/bullying-at-school(?:/|$)","^/health-safety-school-children(?:/|$)","^/school-discipline-exclusions(?:/|$)","^/childcare-out-of-school-hours(?:/|$)","^/after-school-holiday-club(?:/|$)"]}},{identifier:"govuk_transport",surveyType:"url",frequency:20,startTime:new Date("July 27, 2017").getTime(),endTime:new Date("August 26, 2017 23:59:50").getTime(),url:"https://www.smartsurvey.co.uk/s/govuktransportsurvey?c={{currentPath}}",templateArgs:{title:"Help improve GOV.UK.",surveyCta:"Answer 3 quick questions to help us make GOV.UK better",surveyCtaPostscript:"This will open in a new tab."},activeWhen:{path:["^/browse/driving(?:/|$)"],organisation:["<D9>","<D1117>","<EA74>","<EA78>","<EA80>","<EA1114>","<EA570>","<PB459>","<PB460>","<PB461>","<PB462>","<PB463>","<PB1118>","<PB247>","<PB465>","<PC469>","<PC472>","<PC493>","<OT248>","<OT249>"],breadcrumb:["Driving and transport"]}}],init:function(){if(u.canShowAnySurvey()){var e=u.getActiveSurvey(u.defaultSurvey,u.smallSurveys);void 0!==e&&u.displaySurvey(e)}},canShowAnySurvey:function(){return u.pathInBlacklist()?!1:u.otherNotificationVisible()?!1:u.userCompletedTransaction()?!1:e("#user-satisfaction-survey-container").length<=0?!1:!0},processTemplate:function(t,r){return e.each(t,function(e,t){r=r.replace(new RegExp("{{"+e+"}}","g"),t)}),r},getUrlSurveyTemplate:function(){return{render:function(t){var r={title:"Tell us what you think of GOV.UK",surveyCta:"Take the 3 minute survey",surveyCtaPostscript:"This will open a short survey on another website",surveyUrl:u.addCurrentPathToURL(t.url)},a=e.extend(r,t.templateArgs);return u.processTemplate(a,n)}}},getEmailSurveyTemplate:function(){return{render:function(t){var r={title:"Tell us what you think of GOV.UK",surveyCta:"Take a short survey to give us your feedback",surveyFormDescription:"We\u2019ll send you a link to a feedback form. It only takes 2 minutes to fill in.",surveyFormCta:"Send me the survey",surveyFormCtaPostscript:"Don\u2019t worry: we won\u2019t send you spam or share your email address with anyone.",surveyFormNoEmailInvite:"Don\u2019t have an email address?",surveySuccess:"Thanks, we\u2019ve sent you an email with a link to the survey.",surveyFailure:"Sorry, we\u2019re unable to send you an email right now. Please try again later.",surveyId:t.identifier,surveySource:u.currentPath(),surveyUrl:u.addCurrentPathToURL(t.url)},n=e.extend(r,t.templateArgs);return u.processTemplate(n,a)}}},getActiveSurveys:function(t){return e.grep(t,function(e,t){return u.currentTime()>=e.startTime&&u.currentTime()<=e.endTime?u.activeWhen(e):void 0})},getDisplayableSurveys:function(t){return e.grep(t,function(e,t){return u.isSurveyToBeDisplayed(e)})},getActiveSurvey:function(e,t){var r=u.getActiveSurveys(t),n=[e].concat(r),a=u.getDisplayableSurveys(n);return a.length<1?a[0]:a[Math.floor(Math.random()*a.length)]},displaySurvey:function(t){var r=e("#user-satisfaction-survey-container");if("email"===t.surveyType)u.displayEmailSurvey(t,r);else{if("url"!==t.surveyType&&void 0!==t.surveyType)return;u.displayURLSurvey(t,r)}u.incrementSurveySeenCounter(t),u.trackEvent(t.identifier,"banner_shown","Banner has been shown")},displayURLSurvey:function(e,t){var r=u.getUrlSurveyTemplate();t.append(r.render(e)),u.setURLSurveyEventHandlers(e)},displayEmailSurvey:function(e,t){var r=u.getEmailSurveyTemplate();t.append(r.render(e)),u.setEmailSurveyEventHandlers(e)},addCurrentPathToURL:function(e){return e.replace(/\{\{currentPath\}\}/g,u.currentPath())},setEmailSurveyEventHandlers:function(t){var r=e("#email-survey-open"),n=e("#user-survey-cancel"),a=e("#email-survey-pre"),i=e("#email-survey-form"),s=e("#email-survey-post-success"),o=e("#email-survey-post-failure"),c=e("#survey-email-address"),l=e("#take-survey");l.click(function(){u.setSurveyTakenCookie(t),u.hideSurvey(t),u.trackEvent(t.identifier,"no_email_link","User taken survey via no email link")}),r.click(function(e){return t.surveyExpanded=!0,u.trackEvent(t.identifier,"email_survey_open","Email survey opened"),a.addClass("js-hidden").attr("aria-hidden","true"),i.removeClass("js-hidden").attr("aria-hidden","false"),c.focus(),e.stopPropagation(),!1}),n.click(function(e){return u.setSurveyTakenCookie(t),u.hideSurvey(t),t.surveyExpanded?u.trackEvent(t.identifier,"email_survey_cancel","Email survey cancelled"):u.trackEvent(t.identifier,"banner_no_thanks","No thanks clicked"),e.stopPropagation(),!1}),i.submit(function(r){var n=function(){i.addClass("js-hidden").attr("aria-hidden","true"),s.removeClass("js-hidden").attr("aria-hidden","false"),s.focus(),u.setSurveyTakenCookie(t),u.trackEvent(t.identifier,"email_survey_taken","Email survey taken"),u.trackEvent(t.identifier,"banner_taken","User taken survey")},a=function(){i.addClass("js-hidden").attr("aria-hidden","true"),o.removeClass("js-hidden").attr("aria-hidden","false"),o.focus()},c=i.attr("action");return/\.js$/.test(c)||(c+=".js"),e.ajax({type:"POST",url:c,dataType:"json",data:i.serialize(),success:n,error:a,statusCode:{500:a}}),r.stopPropagation(),!1})},setURLSurveyEventHandlers:function(t){var r=e("#user-survey-cancel"),n=e("#take-survey");r.click(function(e){return u.setSurveyTakenCookie(t),u.hideSurvey(t),u.trackEvent(t.identifier,"banner_no_thanks","No thanks clicked"),e.stopPropagation(),!1}),n.click(function(){u.setSurveyTakenCookie(t),u.hideSurvey(t),u.trackEvent(t.identifier,"banner_taken","User taken survey")})},isSurveyToBeDisplayed:function(e){return"true"===GOVUK.cookie(u.surveyTakenCookieName(e))?!1:u.surveyHasBeenSeenTooManyTimes(e)?!1:u.randomNumberMatches(e.frequency)},pathInBlacklist:function(){var e=new RegExp("^/(?:"+/service-manual/.source+")(?:/|$)");return e.test(u.currentPath())},userCompletedTransaction:function(){function e(e,t){return e.indexOf(t)>-1}var t=u.currentPath();return e(t,"/done")||e(t,"/transaction-finished")||e(t,"/driving-transaction-finished")?!0:void 0},trackEvent:function(e,t,r){window.GOVUK.analytics.trackEvent(e,t,{label:r,value:1,nonInteraction:!0})},setSurveyTakenCookie:function(e){window.GOVUK.cookie(u.surveyTakenCookieName(e),!0,{days:90})},incrementSurveySeenCounter:function(e){var t=u.surveySeenCookieName(e),r=u.surveySeenCount(e)+1,n=u.seenTooManyTimesCooloff(e);n?window.GOVUK.cookie(t,r,{days:n}):window.GOVUK.cookie(t,r)},seenTooManyTimesCooloff:function(e){return e.seenTooManyTimesCooloff?l(e.seenTooManyTimesCooloff,void 0,1):void 0},hideSurvey:function(t){e("#user-satisfaction-survey").removeClass("visible").attr("aria-hidden","true")},randomNumberMatches:function(e){return 0===Math.floor(Math.random()*e)},otherNotificationVisible:function(){var t=[".govuk-emergency-banner:visible","#global-cookie-message:visible","#global-browser-prompt:visible","#taxonomy-survey:visible"];return e(t.join(", ")).length>0},surveyHasBeenSeenTooManyTimes:function(e){return u.surveySeenCount(e)>=u.surveySeenTooManyTimesLimit(e)},surveySeenTooManyTimesLimit:function(e){var t=e.seenTooManyTimesLimit;return"unlimited"===String(t).toLowerCase()?1/0:l(t,i,1)},surveySeenCount:function(e){return l(GOVUK.cookie(u.surveySeenCookieName(e)),0,0)},surveyTakenCookieName:function(e){return c("taken_"+e.identifier)},surveySeenCookieName:function(e){return c("survey_seen_"+e.identifier)},pathMatch:function(t){if(void 0===t)return!1;var r=new RegExp(e.map(e.makeArray(t),function(e,t){return/[\^\$]/.test(e)?"(?:"+e+")":"(?:/"+e+"(?:/|$))"}).join("|"));return r.test(u.currentPath())},breadcrumbMatch:function(t){if(void 0===t)return!1;var r=new RegExp(e.makeArray(t).join("|"),"i");return r.test(u.currentBreadcrumb())},sectionMatch:function(t){if(void 0===t)return!1;var r=new RegExp(e.makeArray(t).join("|"),"i");return r.test(u.currentSection())},organisationMatch:function(t){if(void 0===t)return!1;var r=new RegExp(e.makeArray(t).join("|"));return r.test(u.currentOrganisation())},activeWhen:function(e){if(e.hasOwnProperty("activeWhen")){if(e.activeWhen.hasOwnProperty("path")||e.activeWhen.hasOwnProperty("breadcrumb")||e.activeWhen.hasOwnProperty("section")||e.activeWhen.hasOwnProperty("organisation")){var t=e.activeWhen.matchType||"include",r=u.pathMatch(e.activeWhen.path),n=u.breadcrumbMatch(e.activeWhen.breadcrumb),a=u.sectionMatch(e.activeWhen.section),i=u.organisationMatch(e.activeWhen.organisation),s=r||n||a||i;return"exclude"!==t?s:!s}return!0}return!0},currentTime:function(){return(new Date).getTime()},currentPath:function(){return window.location.pathname},currentBreadcrumb:function(){return e(".govuk-breadcrumbs").text()||""},currentSection:function(){return e('meta[name="govuk:section"]').attr("content")||""},currentOrganisation:function(){return e('meta[name="govuk:analytics:organisations"]').attr("content")||""}},c=function(e){var t=e.replace(/(\_\w)/g,function(e){return e.charAt(1).toUpperCase()});return"govuk_"+t},l=function(e,t,r){var n=parseInt(e,10);return isNaN(n)||r>n?t:n};window.GOVUK.userSurveys=u,e(document).ready(function(){window.GOVUK.userSurveys&&window.GOVUK.userSurveys.init()})}(window.jQuery);